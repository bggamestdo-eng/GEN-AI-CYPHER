<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Circle Runner</title>
<style>
  body {
    margin: 0;
    background: #e0f7fa;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
    overflow: hidden;
  }

  #game {
    position: relative;
    width: 800px;
    height: 300px;
    background: linear-gradient(#646363, #e0f7fa);
    border: 2px solid #050505;
    border-radius: 10px;
    overflow: hidden;
  }

  #player {
    position: absolute;
    bottom: 20px;
    left: 50px;
    width: 60px;
    height: 60px;
    background-image: url("PlayerMove1.png");
    background-size: contain;
    background-repeat: no-repeat;
  }

  .obstacle {
    position: absolute;
    bottom: 20px;
    background: #000000;
    border-radius: 4px;
  }

  .ground {
    position: absolute;
    left: 0;
    bottom: 0;
    height: 20px;
    width: 100%;
    background: #969393;
  }

  #score {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 18px;
    font-weight: bold;
    color: #004d40;
  }

  #overlay {
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    font-size: 20px;
    font-weight: bold;
    color: #464545;
  }

  #overlay button {
    margin-top: 10px;
    padding: 8px 15px;
    font-size: 16px;
    background: #00796b;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="game" tabindex="0">
  <div id="player"></div>
  <div class="ground"></div>
  <div id="score">Score: 0</div>
  <div id="overlay">
    <div>Game Over</div>
    <div id="finalScore">Score: 0</div>
    <button id="restartBtn">เล่นอีกครั้ง</button>
  </div>
</div>

<script>
const player = document.getElementById('player');
const game = document.getElementById('game');
const scoreEl = document.getElementById('score');
const overlay = document.getElementById('overlay');
const finalScore = document.getElementById('finalScore');
const restartBtn = document.getElementById('restartBtn');

let playerY = 0;
let velocityY = 0;
let gravity = -2000;
let jumpPower = 800;

let obstacles = [];
let spawnTimer = 0;
let spawnInterval = 1500;
let speed = 260;
let score = 0;
let running = true;
let lastTime = 0;

// ✅ Animation frames
let playerFrames = ["PlayerMove1.png", "PlayerMove2.png", "PlayerMove3.png"];
let currentFrame = 0;
let frameTimer = 0;
let frameInterval = 80; // เปลี่ยนภาพทุก 3 วิ

function spawnObstacle() {
  const obs = document.createElement('div');
  obs.className = 'obstacle';
  const width = 20 + Math.random() * 40;
  const height = 20 + Math.random() * 80;
  obs.style.width = width + 'px';
  obs.style.height = height + 'px';
  obs.style.left = game.clientWidth + 'px';
  game.appendChild(obs);
  obstacles.push({el: obs, x: game.clientWidth, w: width, h: height});
}

function jump() {
  if (playerY === 0) velocityY = jumpPower;
}

function resetGame() {
  obstacles.forEach(o => o.el.remove());
  obstacles = [];
  score = 0;
  overlay.style.display = 'none';
  running = true;
  playerY = 0;
  velocityY = 0;
  lastTime = performance.now();
  requestAnimationFrame(loop);
}

function gameOver() {
  running = false;
  overlay.style.display = 'flex';
  finalScore.textContent = 'Score: ' + Math.floor(score);
}

function checkCollision() {
  const pRect = player.getBoundingClientRect();
  return obstacles.some(o => {
    const oRect = o.el.getBoundingClientRect();
    return !(pRect.right < oRect.left || pRect.left > oRect.right || pRect.bottom < oRect.top || pRect.top > oRect.bottom);
  });
}

function loop(ts) {
  if (!lastTime) lastTime = ts;
  const dt = ts - lastTime;
  lastTime = ts;
  const dtSec = dt / 1000;

  if (running) {

    // Movement / Jump
    velocityY += gravity * dtSec;
    playerY += velocityY * dtSec;
    if (playerY < 0) { playerY = 0; velocityY = 0; }
    player.style.bottom = (20 + playerY) + 'px';

    // Obstacle movement
    spawnTimer += dt;
    if (spawnTimer >= spawnInterval) { spawnTimer = 0; spawnObstacle(); }
    obstacles.forEach(o => { o.x -= speed * dtSec; o.el.style.left = o.x + 'px'; });

    // Score
    score += dtSec * 20;
    scoreEl.textContent = 'Score: ' + Math.floor(score);

    // ✅ Animation loop moved here
    frameTimer += dt;
    if (frameTimer >= frameInterval) {
      frameTimer = 0;
      currentFrame = (currentFrame + 1) % playerFrames.length;
      player.style.backgroundImage = `url(${playerFrames[currentFrame]})`;
    }

    if (checkCollision()) gameOver();
    else requestAnimationFrame(loop);
  }
}

document.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') jump();
});

restartBtn.addEventListener('click', resetGame);

lastTime = performance.now();
requestAnimationFrame(loop);
</script>

</body>
</html>
