<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Register</title>
  <style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');

body{
  font-family:'Prompt',sans-serif;
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#0b0f1f,#11182d);
  color:white;
}

/* ==== GLASS BOX ==== */
.box{
  width:380px;
  background:rgba(16,26,44,0.75);
  backdrop-filter:blur(8px);
  border-radius:22px;
  padding:30px 26px;
  text-align:center;
  border:1px solid rgba(52,239,230,0.35);
  box-shadow:0 0 28px rgba(52,239,230,0.25);
  animation:fadeUp 0.6s ease;
}

/* ==== TITLE ==== */
.box h2{
  margin-top:0;
  margin-bottom:18px;
  color:#34efe6;
  text-shadow:0 0 10px rgba(52,239,230,0.6);
}

/* ==== LABEL ==== */
.box label{
  display:block;
  text-align:left;
  margin:6px 0 4px;
  color:#cfd4ff;
  font-size:14px;
}

/* ==== INPUT ==== */
.box input{
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(52,239,230,0.35);
  background:rgba(16,26,44,0.65);
  color:white;
  font-size:15px;
  outline:none;
  transition:0.25s;

  /* ‚úÖ FIX ‡∏•‡πâ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö */
  box-sizing:border-box;
}


.box input::placeholder{
  color:#8a91c7;
}

.box input:focus{
  border-color:#34efe6;
  box-shadow:0 0 12px rgba(52,239,230,0.55);
}

/* ==== BUTTON ==== */
.box button{
  margin-top:22px;
  width:100%;
  padding:12px;
  border-radius:16px;
  border:none;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  color:black;
  background:linear-gradient(135deg,#34efe6,#14b8a6);
  box-shadow:0 0 18px rgba(52,239,230,0.7);
  transition:0.25s;
}

.box button:hover{
  background:linear-gradient(135deg,#5ffdf6,#34efe6);
  transform:translateY(-2px);
  box-shadow:0 0 26px rgba(95,253,246,1);
}
#saveBtn{
  color: white;
  font-family:'Prompt',sans-serif;
}

/* ==== SMALL MOTION ==== */
@keyframes fadeUp{
  from{
    opacity:0;
    transform:translateY(20px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

  </style>
</head>
<body>
  <div class="box">
    <h2>Register</h2>
    <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label><br>
    <input type="text" id="username" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"><br>
    <button id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>

  <script>
  const saveBtn = document.getElementById("saveBtn");

  saveBtn.addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();

    // ‚úÖ FIX BUG: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô tempEmail ‡∏´‡∏≤‡∏¢
    let email = localStorage.getItem("tempEmail");

    // ‚úÖ fallback ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ tempEmail ‡∏´‡∏•‡∏∏‡∏î
    if (!email) {
      email = localStorage.getItem("currentUser");
    }

    console.log("üìß Email ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ Server:", email);

    // üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°
    if (!username) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
      return;
    }

    if (!email) {
      alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å Google ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà");
      return;
    }

    try {
      // üîó ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend (server.js)
      const res = await fetch("https://gen-ai-cypher.onrender.com/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          email: email, 
          name: username 
        })
      });

      // üì© ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô JSON
      const data = await res.json();
      console.log("üì¶ server response:", data);

if (data.success && data.user) {
  alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

  // ‚úÖ SET LOGIN STATE ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
  localStorage.setItem("currentUser", data.user.name || "");
  localStorage.setItem("currentUserId", data.user.id);
  localStorage.setItem("currentUserEmail", data.user.email);
  localStorage.setItem("isLoggedIn", "true");

  localStorage.removeItem("tempEmail");

  window.location.href = "Home.html";
}
 else {
        alert("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (data.message || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏"));
      }
    } catch (err) {
      console.error("‚ùå Network Error:", err);
      alert("üö´ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î server ‡∏Å‡πà‡∏≠‡∏ô");
    }
  });
  </script>
</body>
</html>
